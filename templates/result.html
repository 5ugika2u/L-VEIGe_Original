<!-- result.html の先頭付近に追加（デバッグ用） -->
<!-- <div style="background: #ffffcc; padding: 10px; margin: 10px 0; border: 1px solid #ccc;">
    <h4>Debug Information:</h4>
    <p><strong>result keys:</strong> {{ result.keys() }}</p>
    <p><strong>image_id:</strong> "{{ result.get('image_id') }}"</p>
    <p><strong>image_id type:</strong> {{ result.get('image_id').__class__.__name__ }}</p>
    <p><strong>All result data:</strong></p>
    <pre>{{ result }}</pre>
</div> -->


<!-- templates/result.html - 修正版 -->
{% extends "base.html" %}

{% block title %}L-VEIGe Result - Learning Vocabulary Error Image Generation{% endblock %}

{% block content %}
<!-- システムタイトル -->
<div class="header">
    <h1>L-VEIGe_Learning Vocabulary Error Image Generation</h1>
    {% if result.is_correct %}
    <p style="color: #4CAF50; font-weight: bold;">Correct Answer</p>
    {% else %}
    <p style="color: #FF6B6B; font-weight: bold;">Incorrect Answer</p>
    {% endif %}
</div>

<!-- 結果表示 -->
<div class="card">
    {% if result.is_correct %}
    <!-- 正答時のレイアウト -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <!-- 左側：元の画像 -->
        <div style="text-align: center;">
            <h3 style="color: #333; margin-bottom: 15px;">Original Image</h3>
            {% if result.get('image_id') %}
            <img src="{{ url_for('static', filename='images3/' + (result.image_id|string).zfill(12) + '.jpg') }}" 
                 alt="Original Image" 
                 style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"
                 onerror="this.src='{{ url_for('static', filename='placeholder.jpg') }}'">
            {% else %}
            <img src="{{ url_for('static', filename='placeholder.jpg') }}" 
                 alt="Original Image" 
                 style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            {% endif %}
        </div>
        
        <!-- 右側：空のスペース（正答時は画像生成なし） -->
        <div style="display: flex; align-items: center; justify-content: center; background: #f8f9ff; border-radius: 10px; border: 2px dashed #ddd;">
            <p style="color: #999; font-style: italic;">No error image needed</p>
        </div>
    </div>
    
    <!-- 正解表記 -->
    <div style="text-align: center; margin: 20px 0;">
        <div style="background: #4CAF50; color: white; padding: 15px 30px; border-radius: 10px; display: inline-block; font-size: 1.2em; font-weight: bold;">
            ✓ Correct
        </div>
    </div>
    
    {% else %}
    <!-- 誤答時のレイアウト -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <!-- 左側：元の画像 -->
        <div style="text-align: center;">
            <h3 style="color: #333; margin-bottom: 15px;">Original Image</h3>
            {% if result.get('image_id') %}
            <img src="{{ url_for('static', filename='images3/' + (result.image_id|string).zfill(12) + '.jpg') }}" 
                 alt="Original Image" 
                 style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"
                 onerror="this.src='{{ url_for('static', filename='placeholder.jpg') }}'">
            {% else %}
            <img src="{{ url_for('static', filename='placeholder.jpg') }}" 
                 alt="Original Image" 
                 style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            {% endif %}
        </div>
        
        <!-- 右側：誤答生成画像 -->
        <div style="text-align: center;">
            <h3 style="color: #333; margin-bottom: 15px;">Error Image</h3>
            {% if result.image_available %}
            <img src="{{ url_for('serve_image', filename=result.generated_image_path) }}" 
                 alt="Generated Error Image" 
                 style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"
                 onerror="this.style.display='none'">
            {% else %}
            <div style="background: #ffe6e6; border: 2px dashed #ffcccc; border-radius: 10px; padding: 40px; color: #999;">
                <p>Error image generation failed</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- 不正解表記 -->
    <div style="text-align: center; margin: 20px 0;">
        <div style="background: #FF6B6B; color: white; padding: 15px 30px; border-radius: 10px; display: inline-block; font-size: 1.2em; font-weight: bold;">
            ✗ Incorrect
        </div>
    </div>
    {% endif %}

    <!-- 完成した文の表示 -->
    <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; margin: 30px 0; border-left: 4px solid #667eea;">
        <h3 style="margin-bottom: 15px; color: #333; text-align: center;">
            {% if result.is_correct %}Your Correct Answer:{% else %}Your Answer:{% endif %}
        </h3>
        <div style="font-size: 1.3em; line-height: 1.6; color: #555; text-align: center; font-weight: 500;">
            {{ result.completed_sentence }}
        </div>
        {% if not result.is_correct %}
        <p style="color: #666; margin-top: 15px; font-size: 0.9em; text-align: center; font-style: italic;">
            Selected word: "{{ result.user_answer }}"
        </p>
        {% endif %}
    </div>

    <!-- 元のキャプション
    <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <p style="margin: 0; color: #666;"><strong>Original Caption:</strong> {{ result.original_caption }}</p>
    </div> -->
</div>

<!-- 進捗とナビゲーション -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span>Progress: {{ session_info.current_question }} / {{ session_info.total_questions }}</span>
        <span>{{ session_info.progress_rate }}%</span>
    </div>
    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ session_info.progress_rate }}%"></div>
    </div>

    {% if is_session_complete %}
    <div style="text-align: center; margin-top: 20px;">
        <p style="font-size: 1.1em; margin-bottom: 20px;">🎊 Session Complete! Great work!</p>
        <a href="{{ url_for('session_complete') }}" class="btn btn-success">
            View Results
        </a>
    </div>
    {% else %}
    <form method="POST" action="{{ url_for('next_question') }}" style="text-align: center; margin-top: 20px;">
        <button type="submit" class="btn">
            Go Next →
        </button>
    </form>
    {% endif %}
</div>
{% endblock %}